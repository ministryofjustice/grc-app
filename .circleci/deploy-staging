version: 2.1

jobs:
  deploy:
    docker:
      - image: circleci/node:latest
    environment:
      CF_SPACE: staging
      APP_NAME_PUBLIC: grc-staging
      APP_NAME_ADMIN: grc-staging-admin
      APP_NAME_DASHBOARD: grc-staging-dashboard
      APP_NAME_IPRESTRICT_ADMIN: grc-staging-iprestrict-admin
      ALLOWED_IPS_ADMIN: << parameters.allowed_ips_admin >>
    steps:
      - run: ./.github/workflows/_deploy-shared.yml
    environment:
      CF_USERNAME: << parameters.cf_username >>
      CF_PASSWORD: << parameters.cf_password >>

workflows:
  version: 2
  deploy_staging:
    jobs:
      - deploy:
          filters:
            tags:
              only: stage-*

parameters:
  cf_username:
    type: string
  cf_password:
    type: string
  allowed_ips_admin:
    type: string
