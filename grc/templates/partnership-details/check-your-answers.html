{% extends 'base.html' %}
{% import "govuk-design-system-templates/_summary-list-item.html" as summary_list_item %}

{% block title %}Check your answers: Marriage or civil partnership details{% endblock %}

{%  set partnerName = 'civil partner'
    if application_data.partnership_details_data.is_in_civil_partnership
    else 'spouse' %}
{%  set inYourPartnershipName = 'in your civil partnership'
    if application_data.partnership_details_data.is_in_civil_partnership
    else 'married' %}

{% block backLink %}
    {% set backLink = (
        url_for('partnershipDetails.endedCheck')
        if application_data.partnership_details_data.is_not_in_partnership
        else (
            url_for('partnershipDetails.interimCheck')
            if not application_data.partnership_details_data.plan_to_remain_in_a_partnership
            else (
                url_for('partnershipDetails.partnerAgrees')
                if application_data.partnership_details_data.partner_agrees
                else url_for('partnershipDetails.interimCheck')
            )
        )
    ) %}
    <a href="{{ backLink }}" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-l">
                <span class="govuk-caption-l">Check your answers:</span>
                Marriage or civil partnership details
            </h1>

            <dl class="govuk-summary-list govuk-!-margin-bottom-9">
                {{ summary_list_item.render(
                    title='Currently married or in a civil partnership',
                    changeLinkHiddenText='if you are currently married or in a civil partnership',
                    changeLinkUrl=url_for('partnershipDetails.index'),
                    value=(application_data.partnership_details_data.currently_in_a_partnership_formatted)
                ) }}

                {% if application_data.partnership_details_data.is_not_in_partnership %}
                    {{ summary_list_item.render(
                        title='Spouse or partner has died',
                        changeLinkHiddenText='if your spouse or partner has died',
                        changeLinkUrl=url_for('partnershipDetails.partnerDied'),
                        value=(application_data.partnership_details_data.previous_partnership_partner_died_formatted)
                    ) }}

                    {{ summary_list_item.render(
                        title='Marriage or civil partnership has ended',
                        changeLinkHiddenText='if your marriage or civil partnership has ended',
                        changeLinkUrl=url_for('partnershipDetails.endedCheck'),
                        value=(application_data.partnership_details_data.previous_partnership_ended_formatted)
                    ) }}

                {% else %}
                    {{ summary_list_item.render(
                        title='Remain ' + inYourPartnershipName,
                        changeLinkHiddenText='if you plan to remain ' + inYourPartnershipName + ' after receiving your Gender Recognition Certificate',
                        changeLinkUrl=url_for('partnershipDetails.stayTogether'),
                        value=(application_data.partnership_details_data.plan_to_remain_in_a_partnership_formatted)
                    ) }}

                    {% if application_data.partnership_details_data.plan_to_remain_in_a_partnership %}
                        {{ summary_list_item.render(
                            title='Can provide a declaration of consent from your ' + partnerName,
                            changeLinkHiddenText='if you can provide a declaration of consent from your ' + partnerName,
                            changeLinkUrl=url_for('partnershipDetails.partnerAgrees'),
                            value=(application_data.partnership_details_data.partner_agrees_formatted)
                        ) }}
                    {% endif %}

                    {% if not application_data.partnership_details_data.plan_to_remain_in_a_partnership or not application_data.partnership_details_data.partner_agrees %}
                        {{ summary_list_item.render(
                            title='Interim GRC',
                            changeLinkHiddenText='if you understand that you will receive an Interim GRC',
                            changeLinkUrl=url_for('partnershipDetails.interimCheck'),
                            value=(application_data.partnership_details_data.confirm_understood_interim_certificate_formatted)
                        ) }}
                    {% endif %}
                {% endif %}
            </dl>

            <form method="POST" action="{{ url_for('partnershipDetails.checkYourAnswers') }}">
                {{ form.csrf_token }}

                <div class="govuk-button-group">
                    <button class="govuk-button" data-module="govuk-button">
                        Save and continue
                    </button>
                    <a href="{{ url_for('taskList.index') }}" class="govuk-link govuk-link--no-visited-state">
                        Return to task list
                    </a>
                </div>
            </form>

        </div>
    </div>
{% endblock %}
