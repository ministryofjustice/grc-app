{% extends 'base.html' %}


{% block backLink %}<a href="{{url_for('personalDetails.address')}}"
   class="govuk-back-link">Back</a>{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    {% if form.errors %}
    <div class="govuk-error-summary"
         aria-labelledby="error-summary-title"
         role="alert"
         tabindex="-1"
         data-module="govuk-error-summary">
      <h2 class="govuk-error-summary__title"
          id="error-summary-title">
        There is a problem
      </h2>
      <div class="govuk-error-summary__body">
        <ul class="govuk-list govuk-error-summary__list">
          {% for error in form.errors %}
          {% for e in form[error].errors %}
          <li><a href="#{{error}}">{{ e }}</a></li>
          {% endfor %}
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}


    <form method="POST"
          action="{{url_for('personalDetails.contactPreferences')}}">
      {{ form.csrf_token }}

      <div class="govuk-form-group {{ 'govuk-form-group--error' if form.errors }}">
        <fieldset class="govuk-fieldset"
                  aria-describedby="contact-hint">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h1 class="govuk-fieldset__heading">
              How would you like to be contacted if we have any questions about your application?
            </h1>
          </legend>
          {% if form.options.errors %}
          <p id="options"
             class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Please select how would you like to be contacted
          </p>
          {% endif %}
          <div class="govuk-checkboxes"
               data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
              <input class="govuk-checkboxes__input"
                     id="email-option"
                     name="options"
                     type="checkbox"
                     value="email"
                     data-aria-controls="conditional-email-option"
                     {{ 'checked'
                     if
                     form.options.data is iterable and "email" in form.options.data
                    }}
              >
              <label class="govuk-label govuk-checkboxes__label"
                     for="email-option">
                Email
              </label>
            </div>
            <div class="govuk-checkboxes__conditional govuk-checkboxes__conditional--hidden"
                 id="conditional-email-option">
              <div class="govuk-form-group">
                <label class="govuk-label"
                       for="email">
                  Email address
                </label>
                {% if form.email.errors %}
                <p id="email-error"
                  class="govuk-error-message">
                  <span class="govuk-visually-hidden">Error:</span> Email address is required
                </p>
                {% endif %}
                <input class="govuk-input govuk-!-width-three-quarters {{ 'govuk-input--error' if form.email.errors }}"
                       id="email"
                       name="email"
                       type="email"
                       spellcheck="false"
                       autocomplete="email"
                       value="{{
                        form.email.data if form.email.data is not none
                       }}">
              </div>

            </div>
            <div class="govuk-checkboxes__item">
              <input class="govuk-checkboxes__input"
                     id="phone-option"
                     name="options"
                     type="checkbox"
                     value="phone"
                     data-aria-controls="conditional-phone"
                     {{ 'checked'
                     if
                     form.options.data is iterable and 'phone' in form.options.data
                    }}>
              <label class="govuk-label govuk-checkboxes__label"
                     for="phone">
                Phone
              </label>
            </div>
            <div class="govuk-checkboxes__conditional govuk-checkboxes__conditional--hidden"
                 id="conditional-phone">
              <div class="govuk-form-group">
                <label class="govuk-label"
                       for="phone">
                  Phone number
                </label>
                {% if form.phone.errors %}
                <p id="phone-error"
                  class="govuk-error-message">
                  <span class="govuk-visually-hidden">Error:</span> Phone number is required
                </p>
                {% endif %}
                <input class="govuk-input govuk-input--width-20 {{ 'govuk-input--error' if form.phone.errors }}"
                       id="phone"
                       name="phone"
                       type="tel"
                       autocomplete="tel"
                       value="{{
                        form.phone.data if form.phone.data is not none
                       }}">
              </div>

            </div>
            <div class="govuk-checkboxes__item">
              <input class="govuk-checkboxes__input"
                     id="post-option"
                     name="options"
                     type="checkbox"
                     value="post"
                     data-aria-controls="conditional-post-option"
                     {{ 'checked'
                     if
                     form.options.data is iterable and "post" in form.options.data
                    }}>
              <label class="govuk-label govuk-checkboxes__label"
                     for="post-option">
                Post
              </label>
            </div>
            <div class="govuk-checkboxes__conditional govuk-checkboxes__conditional--hidden"
                 id="conditional-post-option">
              <div class="govuk-form-group">
                <p class="govuk-body">{{address}}</p>
              </div>

            </div>
          </div>
        </fieldset>
      </div>

      <div class="govuk-button-group">
        <button class="govuk-button"
                data-module="govuk-button">
          Save and continue
        </button>
        <a href="{{url_for('taskList.index')}}"
           class="govuk-link govuk-link--no-visited-state">Return to task list</a>
      </div>
    </form>


  </div>
</div>
{% endblock %}
