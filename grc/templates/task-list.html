{% extends 'base.html' %}
{% import "helper-macros/random-id.html" as random_id %}

{% macro taskListItem(text, url, status, suffix, id=None) %}
    {% set id = id or 'id-' + random_id.randomId(10) %}

    <li class="app-task-list__item">
        <span class="app-task-list__task-name">
            {% if status == ListStatus.CANNOT_START_YET %}
                {{ text }}
            {% else %}
                <a href="{{ url }}" class="govuk-link" aria-describedby="{{ id }}">
                    {{ text }}
                </a>
            {% endif %}
        </span>
        <strong id="{{ id }}" class="govuk-tag app-task-list__tag {{ get_colour(status) }}">
            {{ status.value }}
        </strong>
        {{ suffix }}
    </li>
{% endmacro %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <h1 class="govuk-heading-l">
                Your application
            </h1>
        </div>

        <div class="govuk-grid-column-two-thirds">
            <p class="govuk-body">
                This is where you can provide your personal details and upload your documents.
            </p>

            <div class="govuk-inset-text govuk-!-margin-bottom-8">
                <p class="govuk-body">
                    You can upload most documents online, but you will need to post us your birth certificate.
                </p>

                <p class="govuk-body">
                    What you need to upload depends on the information you provide during your application.
                </p>
            </div>

            <ol class="app-task-list app-task-list--no-numbers">
                <li>
                    <h2 class="app-task-list__section">
                    Before you start
                    </h2>

                    <ul class="app-task-list__items">
                        {{ taskListItem(
                            "Confirmation",
                            url_for(session['application']['confirmation']['step']),
                            list_status['confirmation'])
                        }}
                    </ul>
                </li>

                <!-- Fill in your details -->
                <li>
                    <h2 class="app-task-list__section">
                        Fill in your details
                    </h2>

                    <ul class="app-task-list__items">
                        {{ taskListItem(
                            "Your personal details",
                            url_for(session['application']['personalDetails']['step']),
                            list_status['personalDetails'])
                        }}

                        {{ taskListItem(
                            "Your birth registration information",
                            url_for(session['application']['birthRegistration']['step']),
                            list_status['birthRegistration'])
                        }}

                        {{ taskListItem(
                            "Marriage or civil partnership details",
                            url_for(session['application']['partnershipDetails']['step']),
                            list_status['partnershipDetails'])
                        }}
                    </ul>
                </li>
                <!-- /.Fill in your details -->

                <!-- Upload your documents -->
                <li>
                    <h2 class="app-task-list__section">
                        Upload your documents
                    </h2>

                    <ul class="app-task-list__items">
                        {% if application.confirmation.overseasCheck == 'No' %}
                            {{ taskListItem(
                                "Your medical reports",
                                url_for('upload.medicalReports'),
                                list_status['medicalReports'])
                            }}

                            {{ taskListItem(
                                "Evidence of living in your gender",
                                url_for('upload.genderEvidence'),
                                list_status['genderEvidence'])
                            }}

                            {% if application.personalDetails.previousNamesCheck is defined and application.personalDetails.previousNamesCheck == 'Yes' %}
                                {{ taskListItem(
                                    "Name change documents",
                                    url_for('upload.nameChange'),
                                    list_status['nameChange'])
                                }}
                            {% endif %}

                        {% elif application.confirmation.overseasCheck == 'Yes' and application.personalDetails.previousNamesCheck is defined and application.personalDetails.previousNamesCheck == 'Yes' %}
                            {{ taskListItem(
                                "Name change documents",
                                url_for('upload.nameChange'),
                                list_status['nameChange'])
                            }}
                        {% endif %}

                        {% if application.partnershipDetails.marriageCivilPartnership is defined and (application.partnershipDetails.marriageCivilPartnership == 'Married' or (application.partnershipDetails.marriageCivilPartnership == 'Neither' and (application.partnershipDetails.marriageCivilPartnership.partnerDied == 'Yes' or application.partnershipDetails.marriageCivilPartnership.endedCheck == 'Yes'))) %}
                            {{ taskListItem(
                                "Marriage documents",
                                url_for('upload.marriageDocuments'),
                                list_status['marriageDocuments'])
                            }}
                        {% endif %}

                        {% if application.confirmation.overseasApprovedCheck == 'Yes' %}
                            {{ taskListItem(
                                "Overseas certificate documents",
                                url_for('upload.overseasCertificate'),
                                list_status['overseasCertificate'])
                            }}
                        {% endif %}

                        {{ taskListItem(
                            "Statutory declarations",
                            url_for('upload.statutoryDeclarations'),
                            list_status['statutoryDeclarations'])
                        }}
                    </ul>
                </li>
                <!-- /.Upload your documents -->

                <!-- Apply -->
                <li>
                    <h2 class="app-task-list__section">
                        Apply
                    </h2>

                    <ul class="app-task-list__items">
                        {% macro submitAndPaySuffix() %}
                            <span class="govuk-hint govuk-!-margin-top-3 govuk-!-margin-bottom-0"><br>
                                Once you have completed the other sections you can submit your application.
                            </span>
                        {% endmacro %}
                        {{ taskListItem(
                            "Submit and pay",
                            url_for('submitAndPay.index'),
                            list_status['submitAndPay'],
                            submitAndPaySuffix())
                        }}
                    </ul>
                </li>
                <!-- /.Apply -->
            </ol>
        </div>

        <div class="govuk-grid-column-one-third">
            <div class="gem-c-contextual-sidebar">
                <div class="gem-c-related-navigation">
                    <h2 id="related-nav-related_items-298b5325" class="gem-c-related-navigation__main-heading">
                        Returning to your application
                    </h2>
                    <p class="govuk-body-s">
                        Your application is saved automatically as you progress.
                    </p>
                    <p class="govuk-body-s">
                        <a href="{{ url_for('saveAndReturn.exitApplication') }}" class="govuk-link govuk-link--no-visited-state">Exit and return later</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
